<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soạn Thảo Văn Bản HC - Chặt Tỉa Cây Xanh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --a4-width: 210mm;
            --a4-height: 297mm;
        }

        body {
            background-color: #f0f2f5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Editor Panel */
        .editor-panel {
            background: white;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        /* Preview Panel */
        .preview-panel {
            background: #525659;
            padding: 30px;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        /* A4 Page Simulation - Quy chuẩn Nghị định 30 */
        #document-preview {
            background: white;
            width: var(--a4-width);
            min-height: var(--a4-height);
            padding: 20mm 15mm 20mm 30mm; /* Top Right Bottom Left */
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            font-family: "Times New Roman", Times, serif;
            font-size: 14pt;
            line-height: 1.5;
            color: black;
            position: relative;
        }

        /* Typography helpers for Document */
        .doc-header-table {
            width: 100%;
            margin-bottom: 20px;
        }
        .doc-header-table td {
            vertical-align: top;
            text-align: center;
            padding: 0;
        }
        .org-name {
            font-size: 13pt;
            font-weight: normal;
        }
        .org-subname {
            font-size: 13pt;
            font-weight: bold;
            border-bottom: 1px solid #000;
            display: inline-block;
            padding-bottom: 2px;
            margin-bottom: 5px;
        }
        .doc-number {
            font-size: 13pt;
        }
        .nation-title {
            font-size: 13pt;
            font-weight: bold;
        }
        .nation-motto {
            font-size: 14pt;
            font-weight: bold;
            border-bottom: 1px solid #000;
            display: inline-block;
            padding-bottom: 2px;
            margin-bottom: 5px;
        }
        .doc-date {
            font-size: 14pt;
            font-style: italic;
        }
        .doc-recipient {
            font-size: 14pt;
            margin-top: 10px;
            font-weight: bold;
        }
        .doc-subject {
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 15px;
            text-align: left; /* Trích yếu nội dung canh trái dưới số ký hiệu hoặc canh giữa tùy mẫu, ở đây để canh trái theo mẫu CV */
        }
        .doc-body {
            text-align: justify;
            margin-top: 10px;
        }
        .doc-body p {
            margin-bottom: 6pt;
            text-indent: 1.27cm; /* Thụt đầu dòng */
        }
        .doc-list-tree {
            margin-top: 10px;
            margin-bottom: 10px;
            white-space: pre-line; /* Giữ xuống dòng từ textarea */
        }
        .doc-footer-table {
            width: 100%;
            margin-top: 30px;
        }
        .doc-footer-table td {
            vertical-align: top;
        }
        .recipient-list {
            font-size: 12pt;
        }
        .recipient-title {
            font-weight: bold;
            font-size: 12pt;
            font-style: italic;
        }
        .sign-title {
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
        }
        .sign-name {
            font-weight: bold;
            text-align: center;
            margin-top: 80px;
        }

        /* Utility */
        .form-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #495057;
        }
        textarea.form-control {
            font-family: "Times New Roman", Times, serif; /* Để người dùng nhập thấy giống kết quả */
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js-typescript@0.1.5/dist/index.min.js"></script> </head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-5 editor-panel">
            <h4 class="mb-4 text-primary"><i class="fas fa-file-signature"></i> Soạn Thảo Văn Bản</h4>
            
            <div class="mb-3">
                <button class="btn btn-danger me-2" onclick="exportPDF()"><i class="fas fa-file-pdf"></i> Xuất PDF</button>
                <button class="btn btn-primary" onclick="exportWord()"><i class="fas fa-file-word"></i> Xuất Word</button>
            </div>

            <form id="docForm">
                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">1. Thông tin chung</h6>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="form-label">Số văn bản</label>
                        <input type="text" class="form-control" id="inp_soVB" value="46/LĐCT-ĐQLĐD">
                    </div>
                    <div class="col-6">
                        <label class="form-label">Ngày ban hành</label>
                        <input type="text" class="form-control" id="inp_date" value="Tân Sơn Hòa, ngày 07 tháng 01 năm 2026">
                    </div>
                </div>

                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">2. Nội dung chính</h6>
                <div class="mb-3">
                    <label class="form-label">Trích yếu (Về việc...)</label>
                    <textarea class="form-control" id="inp_subject" rows="2">Về việc chặt tỉa cây xanh gần đường dây 110kV Phú Định - Hùng Vương</textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Kính gửi (Nơi nhận chính)</label>
                    <textarea class="form-control" id="inp_to" rows="4">- Trung tâm Quản lý hạ tầng kỹ thuật TP.HCM
- Công ty TNHH Một Thành viên Công viên Cây xanh
- Xí nghiệp Công viên Cây xanh 2</textarea>
                </div>
                
                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">3. Căn cứ pháp lý & Lý do</h6>
                <div class="mb-3">
                    <label class="form-label">Các căn cứ (mỗi căn cứ 1 dòng)</label>
                    <textarea class="form-control" id="inp_bases" rows="6">Căn cứ Luật Điện lực số 61/2024/QH11 của Quốc hội nước Cộng Hòa Xã Hội Chủ Nghĩa Việt Nam;
Căn cứ Nghị định số 62/2025/NĐ-CP ngày 04/3/2025 của Chính Phủ về việc Quy định chi tiết thi hành Luật điện lực về bảo vệ công trình điện lực và an toàn trong lĩnh vực điện lực;
Căn cứ Thông tư số 02/2025/TT-BCT ngày 01 tháng 02 năm 2025 của Bộ Công Thương quy định về bảo vệ công trình điện lực và an toàn trong lĩnh vực điện lực;
Căn cứ Quy chế phối hợp số 5597/QCPH-TTHT-TCTĐLTPHCM ngày 21/12/2020 ký giữa EVNHCMC và Trung tâm Quản lý hạ tầng Kỹ thuật Tp.HCM;
Căn cứ Kế hoạch cắt điện đường dây 110kV Phú Định - Hùng Vương từ 8 giờ 00 đến 16 giờ 00 ngày 18/12/2025;</textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label">Đoạn mở đầu (Hiện trạng...)</label>
                    <textarea class="form-control" id="inp_intro" rows="4">Hiện nay, do phụ tải tăng cao nên việc cắt điện đường dây 110kV Phú Định - Hùng Vương gặp rất nhiều khó khăn. Đặc biệt đường dây 110kV Phú Định - Hùng Vương cung cấp điện cho hai trạm biến áp 110kV: Phú Định và Hùng Vương.</textarea>
                </div>

                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">4. Đề xuất & Kế hoạch</h6>
                <div class="mb-3">
                    <label class="form-label">Nội dung đề nghị (Thời gian cắt điện)</label>
                    <textarea class="form-control" id="inp_proposal" rows="4">Nhằm đảm bảo an toàn cho sự vận hành liên tục của đường dây 110kV Phú Định - Hùng Vương, Công ty Lưới điện cao thế TP.HCM (Công ty LĐCT) kính đề nghị Quý Cơ quan chặt tỉa các cây xanh có khả năng vi phạm khoảng cách an toàn trong thời gian cắt điện đường dây 110kV Phú Định - Hùng Vương từ 8 giờ 00 đến 16 giờ 00 ngày 22/01/2026.</textarea>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Thời gian khảo sát</label>
                    <input type="text" class="form-control" id="inp_surveyTime" value="từ 13 giờ 30 phút đến 15 giờ 00 phút, Thứ Sáu ngày 16/01/2026">
                </div>
                <div class="mb-3">
                    <label class="form-label">Địa điểm khảo sát</label>
                    <input type="text" class="form-control" id="inp_surveyLoc" value="Giao lộ Võ Văn Kiệt giao với Bình Tiên">
                </div>

                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">5. Danh sách cây & Liên hệ</h6>
                <div class="mb-3">
                    <label class="form-label">Danh sách cây (Chi tiết)</label>
                    <textarea class="form-control" id="inp_treeList" rows="10" style="font-size: 13px;">Tuyến đường Bình Tiên:
+ Khoảng trụ 9 - 10: 2 cây (17, 4)
+ Khoảng trụ 10 - 11: 3 cây (12, 20, 10)
+ Khoảng trụ 11 - 12: 1 cây (26)
+ Khoảng trụ 13 - 14: 5 cây (52, 58, 60, 62, 64)
+ Khoảng trụ 15 - 16: 3 cây (3, 5, 7)
+ Khoảng trụ 16 - 17: 5 cây (21, 17, 15, 13, 11)
+ Khoảng trụ 18 - 19: 7 cây (31, 33, 35, 37, 39, 41, 43)
+ Khoảng trụ 20 - 21: 3 cây (49, 51, 53)

Tuyến đường Hồng Bàng:
+ Khoảng trụ 22 - 23: 1 cây (cây bồ đề không số)
+ Khoảng trụ 28 - 29: 7 cây (G81, G82, G83, G84, G85, G86, G87)
+ Khoảng trụ 29 - 30: 5 cây (G76, G77, G78, G79, G80)
+ Khoảng trụ 30 - 31: 6 cây (G69, G70, G71, G72, G73, G74)
+ Khoảng trụ 31 - 32: 2 cây (G66, G67)
+ Khoảng trụ 32 - 33: 7 cây (G59, G60, G62, G63, G64, G61, G65)
+ Khoảng trụ 33 - 34: 5 cây (G53, G55, G56, G57, G58)
+ Khoảng trụ 34 - 35: 7 cây (G50, G46, G47, G48, G49, G51, G52)
+ Khoảng trụ 35 - 36: 6 cây (G39, G43, G44, G40, G41, G45)
+ Khoảng trụ 36 - 37: 2 cây (G37, G38)</textarea>
                </div>
                 <div class="mb-3">
                    <label class="form-label">Thông tin liên hệ</label>
                    <textarea class="form-control" id="inp_contact" rows="3">Tổ Đường dây – ĐT: 02822.450.951 hoặc anh Leng SoPhon – Tổ phó tổ QLĐD 1, số điện thoại: 0902.534.184 hoặc anh Dương Trung Hiếu – Đội phó Đội QLĐD, số điện thoại: 0938.040.285.</textarea>
                </div>

                <h6 class="text-uppercase text-secondary border-bottom pb-2 mt-4">6. Chữ ký & Nơi nhận</h6>
                <div class="mb-3">
                    <label class="form-label">Nơi nhận (Footer)</label>
                    <textarea class="form-control" id="inp_footerRecipients" rows="4">- Như trên;
- Giám đốc (để báo cáo);
- P AT (để biết);
- Lưu: VT, ĐQLĐD.(02).</textarea>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="form-label">Chức vụ ký</label>
                        <input type="text" class="form-control" id="inp_signTitle" value="TUQ. GIÁM ĐỐC">
                        <input type="text" class="form-control mt-1" id="inp_signRole" value="KT. ĐỘI TRƯỞNG">
                        <input type="text" class="form-control mt-1" id="inp_signRole2" value="ĐỘI PHÓ">
                    </div>
                    <div class="col-6">
                        <label class="form-label">Người ký</label>
                        <input type="text" class="form-control" id="inp_signName" value="Dương Trung Hiếu">
                    </div>
                </div>
                <div class="mb-5"></div>
            </form>
        </div>

        <div class="col-md-7 preview-panel">
            <div id="document-preview">
                <table class="doc-header-table">
                    <tr>
                        <td style="width: 40%;">
                            <div class="org-name">TỔNG CÔNG TY<br>ĐIỆN LỰC TP HỒ CHÍ MINH</div>
                            <div class="org-subname">CÔNG TY LƯỚI ĐIỆN CAO THẾ<br>THÀNH PHỐ HỒ CHÍ MINH</div>
                            <div class="doc-number" id="prev_soVB">Số: 46/LĐCT-ĐQLĐD</div>
                        </td>
                        <td style="width: 60%;">
                            <div class="nation-title">CỘNG HÒA XÃ HỘI CHỦ NGHĨA VIỆT NAM</div>
                            <div class="nation-motto">Độc lập - Tự do - Hạnh phúc</div>
                            <div class="doc-date" id="prev_date">Tân Sơn Hòa, ngày 07 tháng 01 năm 2026</div>
                        </td>
                    </tr>
                </table>

                <div class="doc-subject" id="prev_subject">Về việc chặt tỉa cây xanh gần đường dây 110kV Phú Định - Hùng Vương</div>

                <div style="margin-top: 10px;">
                    <strong>Kính gửi:</strong>
                    <div id="prev_to" style="margin-left: 20px; font-weight: bold;"></div>
                </div>

                <div class="doc-body">
                    <div id="prev_bases"></div>
                    
                    <p id="prev_intro">Hiện nay, do phụ tải tăng cao...</p>
                    
                    <p id="prev_proposal">Nhằm đảm bảo an toàn...</p>
                    
                    <p>Để chuẩn bị đầy đủ nhân lực, phương tiện phối hợp thực hiện chặt tỉa toàn bộ số cây xanh cần chặt tỉa.</p>
                    
                    <p>Công ty LĐCT kính đề nghị Quý Cơ quan cử cán bộ cùng khảo sát hiện trường để thống nhất số lượng cây xanh cần chặt, tỉa;</p>
                    
                    <p>Thời gian và địa điểm khảo sát cụ thể như sau:</p>
                    <div style="margin-left: 1.27cm;">
                        - Thời gian: <span id="prev_surveyTime"></span>.<br>
                        - Địa điểm: <span id="prev_surveyLoc"></span>.
                    </div>

                    <p>Các cây xanh cần thực hiện chặt tỉa vào các ngày cắt điện từ 8 giờ 00 đến 16 giờ 00 ngày 22/01/2026 đối với đường dây như sau:</p>
                    
                    <div class="doc-list-tree" id="prev_treeList"></div>

                    <p>Trước khi thực hiện kính đề nghị Quý Cơ quan liên hệ Công ty LĐCT để phối hợp thực hiện các biện pháp an toàn trong quá trình công tác.</p>
                    
                    <p>Mọi chi tiết xin vui lòng liên hệ: <span id="prev_contact"></span></p>

                    <p>Trân trọng./.</p>
                </div>

                <table class="doc-footer-table">
                    <tr>
                        <td style="width: 50%;">
                            <div class="recipient-title">Nơi nhận:</div>
                            <div class="recipient-list" id="prev_footerRecipients"></div>
                        </td>
                        <td style="width: 50%; text-align: center;">
                            <div class="sign-title" id="prev_signTitle">TUQ. GIÁM ĐỐC</div>
                            <div class="sign-title" id="prev_signRole">KT. ĐỘI TRƯỞNG</div>
                            <div class="sign-title" id="prev_signRole2">ĐỘI PHÓ</div>
                            <div class="sign-name" id="prev_signName">Dương Trung Hiếu</div>
                        </td>
                    </tr>
                </table>

            </div>
        </div>
    </div>
</div>

<script>
    // --- Data Binding & Live Preview ---
    const inputs = {
        'inp_soVB': 'prev_soVB',
        'inp_date': 'prev_date',
        'inp_subject': 'prev_subject',
        'inp_intro': 'prev_intro',
        'inp_proposal': 'prev_proposal',
        'inp_surveyTime': 'prev_surveyTime',
        'inp_surveyLoc': 'prev_surveyLoc',
        'inp_treeList': 'prev_treeList',
        'inp_contact': 'prev_contact',
        'inp_signTitle': 'prev_signTitle',
        'inp_signRole': 'prev_signRole',
        'inp_signRole2': 'prev_signRole2',
        'inp_signName': 'prev_signName'
    };

    const listInputs = {
        'inp_to': 'prev_to',
        'inp_bases': 'prev_bases',
        'inp_footerRecipients': 'prev_footerRecipients'
    };

    function updatePreview() {
        // Simple Text Updates
        for (let [inpId, prevId] of Object.entries(inputs)) {
            let val = document.getElementById(inpId).value;
            let el = document.getElementById(prevId);
            if(inpId === 'inp_soVB') val = "Số: " + val;
            if(el) el.innerText = val;
        }

        // List Updates (Convert newlines to divs or br)
        for (let [inpId, prevId] of Object.entries(listInputs)) {
            let val = document.getElementById(inpId).value;
            let lines = val.split('\n');
            let html = lines.map(line => `<div>${line}</div>`).join('');
            document.getElementById(prevId).innerHTML = html;
        }
    }

    // Attach Event Listeners
    document.querySelectorAll('input, textarea').forEach(el => {
        el.addEventListener('input', updatePreview);
    });

    // Initial call
    updatePreview();


    // --- Export Functions ---

    function exportPDF() {
        const element = document.getElementById('document-preview');
        const opt = {
            margin:       0, // margins are handled by css padding inside the element
            filename:     'CongVan_ChatCay.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }

    function exportWord() {
        // Simple HTML export suitable for Word
        // To make it look right in Word, we need to inject a specific XML structure or
        // use a "MHT" style, but for simple client-side JS, wrapping HTML with Word XML namespaces works decently.
        
        var preHtml = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML To Doc</title></head><body>";
        var postHtml = "</body></html>";
        
        // Clone the preview to modify styles for export if needed (e.g., removing shadows)
        var clone = document.getElementById('document-preview').cloneNode(true);
        clone.style.boxShadow = "none";
        clone.style.margin = "0";
        clone.style.width = "100%";
        
        var html = preHtml + clone.innerHTML + postHtml;

        var blob = new Blob(['\ufeff', html], {
            type: 'application/msword'
        });
        
        // Create download link
        var url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
        var link = document.createElement("a");
        document.body.appendChild(link);
        
        if(navigator.msSaveOrOpenBlob ){
            navigator.msSaveOrOpenBlob( blob, 'CongVan_ChatCay.doc');
        }else{
            link.href = URL.createObjectURL(blob);
            link.download = 'CongVan_ChatCay.doc';
            link.click();
        }
        
        document.body.removeChild(link);
    }
</script>

</body>
</html>
